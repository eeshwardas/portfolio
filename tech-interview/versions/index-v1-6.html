<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

		<script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
		<script src="https://unpkg.com/popper.js@1.15.0/dist/umd/popper.min.js" integrity="" crossorigin="anonymous"></script>

		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
		<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

		<link href="flyer-layer.css" rel="stylesheet" type="text/css">
		<link href="assets.css" rel="stylesheet" type="text/css">
		<style type="text/css">
			.v-spacer {
			  height: 100px;
			}
			.h-spacer {
				align-self: center;
			}
			.ui-autocomplete-loading {
				background: white url("loading.gif") right center no-repeat;
			}
			.z-layer-front
			{
				z-index: 5000;
			}
			.z-layer-back
			{
				z-index: 4500;
			}
		</style>
		<title>Technical Interview</title>
	</head>
	<body class="m-0 p-0 gr-sw-font-antic-slab">
		<div class="m-0 p-0 container-fluid">
			<div class="m-0 p-0">
				<div class="m-0 p-0 gr-sw-layer-flyer-min-width">
					<div class="m-0 p-0 h-75">
						<header class="m-0 p-0 gr-sw-layer-flyer-header-thinline">
							<h1 class="m-0 p-0 gr-sw-layer-flyer-header-thinline">
								Technical Interview
							</h1>
						</header>
						<main class="m-0 p-0">
							<article class="m-0 p-0">
								<div class="m-0 p-0 vw-100">
									<div class="m-0 p-0 v-spacer">
									</div>
									<div class="m-0 p-0 w-25 d-inline-block">
									</div>
									<div class="m-0 p-0 w-50 d-inline-block h-spacer">
										<div class="">
											<div id="textEntry" class="m-0 p-0" class="input-group mb-3">
												<input id="charactersEntered" type="text"
													class="form-control" placeholder="Enter characters"
													aria-label="Enter characters" aria-describedby="Submit">
											</div>
										</div>
										<div id="completedWord" class="m-0 p-0 list-group">
										</div>
									</div>
								</div>
							</article>
						</main>
					</div>
				</div>
			</div>
		</div>
		<div id="debug">
		
		</div>
		<script type="text/javascript">
			"use strict";

			// debug
			class TechInterviewDebug
			{
				getDebuggingCapabilitiesCanDebug()
				{
					return false;
				}
				
				//const debug = document.getElementById("debug");
				//const isDebugging = false;
				
				debugOut(text)
				{
					if (isDebugging)
					{
						$("#debug").innerHTML = text + "<br />" + $("#debug").innerHTML;
					}
				}
			}
		
			// Processing
			class TechInterviewProcessing
			{
				processResults(data, textStatus, jqXHR) {
					textStatus = null;
					jqXHR = null;
					
					const autoCompleteList = this.unpackJQueryJson(data);
					
					if (this.validateResults(autoCompleteList))
					{
						this.sendToUI(autoCompleteList);
					}
				}
				
				unpackJQueryJson(data)
				{
					return Object.values(data)[0];
				}
			
				sendToUI(autoCompleteList) {
					techInterviewUI.fillAutoCompleteList(autoCompleteList);
				}
				
				validateResults(autoCompleteList)
				{
					const communicationsReliabilityThreshold = 0.60;
					let communicationReliabilityThresholdSuccessDensity = 0;
					let communicationReliabilityThresholdSuccessCumulativeDensity = 0;
					let communicationsReliabilityProbablity = 1.00;
					let isValid = true;
					
					const charactersEntered = techInterviewUI.getCharactersEntered();
					for (let i=0; i<autoCompleteList.length; i++)
					{
						if (charactersEntered.length < 3)
						{
							if (autoCompleteList[i].toLocaleLowerCase('en-US').startsWith(
								charactersEntered.toLocaleLowerCase('en-US')))
							{
								communicationReliabilityThresholdSuccessDensity = 1.00;
							}
							else
							{
								communicationReliabilityThresholdSuccessCumulativeDensity = 0.00;
							}
						}
						else
						{
							let communicationItemReliabilitySuccessCount = 0;
							for (let j=0; ( (j<charactersEntered.length) &&
								(charactersEntered.length <= autoCompleteList[i].length) ); j++)
							{
								if (charactersEntered[j].toLocaleLowerCase('en-US') ==
									autoCompleteList[i][j].toLocaleLowerCase('en-US'))
								{
									communicationItemReliabilitySuccessCount++;
								}
							}
							communicationReliabilityThresholdSuccessDensity =
								( communicationItemReliabilitySuccessCount / charactersEntered.length );
						}
						communicationReliabilityThresholdSuccessCumulativeDensity += communicationReliabilityThresholdSuccessDensity;
					}
					communicationsReliabilityProbablity = communicationReliabilityThresholdSuccessCumulativeDensity / autoCompleteList.length;
					if (communicationsReliabilityProbablity < communicationsReliabilityThreshold)
					{
						isValid = false;					
					}
					return isValid;
				}
			}
				
			// Ajax
			class TechInterviewAjax
			{
				constructor()
				{
					this.isStressReduced = true;
					this.isReducingStress = false;
				}
			
				getNetworkingAvailabilityCapabilitiesCanNetwork()
				{
					return true;
				}
			
				//const getNetworkingAvailabilityCapabilities = false;
				
				//let isStressReduced = true;
				//let isReducingStress = false;
				
				networkRequest()
				{
					let isNetworkRequestAvailable = false;
					if (this.isStressReduced)
					{
						isNetworkRequestAvailable = true;
						this.setNetworkRequestPermitted();
					}
					return isNetworkRequestAvailable;
				}
				
				setNetworkRequestPermitted()
				{
					this.isStressReduced = false;
					this.setNetworkToReduceStress();
				}
				
				setNetworkToReduceStress()
				{
					this.isReducingStress = true;
					setTimeout( () => this.setNetworkDeStressed(), 1000);			
				}
				
				setNetworkDeStressed()
				{
					this.isStressReduced = true;
					this.isReducingStress = false;
					techInterviewUI.setUiNetworkRequestAvailable();
				}

				getSuggestedResultsFromAPI(charactersToAutocomplete)
				{
					if (this.getNetworkingAvailabilityCapabilitiesCanNetwork()) {
						const apiRequest = this.genereateApiRequest(charactersToAutocomplete);
						$.get( apiRequest, null, (data, textStatus, jqXHR ) =>
							techInterviewProcessing.processResults(data, textStatus, jqXHR), "json" );
					}
					else {
						techInterviewProcessing.processResults(this.getLocalDataSet(), null, null);
					}
				}
				
				genereateApiRequest(charactersToAutocomplete)
				{
					return "https://mock-autocomplete.herokuapp.com/autocomplete?q="
						+ charactersToAutocomplete;
				}
				
				getLocalDataSet()
				{	
					const data = {"data":["Alabama","Alaska","Ã…land Islands"]};
					//data = {"data":["Afghanistan","Alabama","Alaska","Albania","Albany"]};
					return data;
				}
			}
				
			// UI
			class TechInterviewUI
			{
				constructor()
				{
					this.isAutoCompleteNeeded = false;
					//this.arrowDownKey = 
					//this.arrowUpKey = 
				}
				
				getArrowDownKey()
				{
					return 40;
				}
				getArrowUpKey()
				{
					return 38;
				}
			
				//let isAutoCompleteNeeded = false;
				//const arrowDownKey = 40;
				//const arrowUpKey = 38;
				
				initUIEvents()
				{
					$("#charactersEntered").keydown((event) => this.charactersEnteredKeyDownEvent(event));
					$("#charactersEntered").keyup((event) => this.charactersEnteredKeyUpEvent(event));
					$("#completedWord").focusout((event) => this.completedWordFocusOut(event));
				}
				
				initUI()
				{
					this.initUIEvents();
				}
				
				ititUIElements()
				{
					$("#completedWord").hide();
				}
				
				completedWordFocusOut(event)
				{
					this.completedWordItemsReset();
				}
				
				completedWordItemClicked(event)
				{
					const selectedItem = event.data;
					$("#charactersEntered").val(selectedItem);
					$("#completedWord").hide();
				}
				
				completedWordChangeEvent()
				{
					$("#charactersEntered").val($("#completedWord").val());
				}
				
				completedWordItemsReset()
				{
					$("#completedWord > button").removeClass("active");
				}
				
				completedWordItemSetActive(tagIdNext, tagIdPrev)
				{
					$(tagIdNext).trigger("focus");
					$(tagIdNext).addClass("active");
					
					$(tagIdPrev).removeClass("active");
				}
				
				completedWordKeyDownEvent(event)
				{
					if ((event.which === this.getArrowDownKey()) || 
						(event.which === this.getArrowUpKey()))
					{
						let modifier = null;
						let isRoomLeft = true;
						const tagButtons = "#completedWord > button";
						if (event.which === this.getArrowDownKey())
						{
							modifier = 1;
							isRoomLeft = (event.data < $(tagButtons).length - 1);
						}
						else if (event.which === this.getArrowUpKey())
						{
							modifier = -1;
							isRoomLeft = (event.data > 0);
							if (!isRoomLeft)
							{
								$("#charactersEntered").trigger("focus");
							}
						}

						const tagIdPrev = "#completedWordItem-" + event.data;
						const tagIdNext = "#completedWordItem-" + (event.data + modifier);
						if (isRoomLeft)
						{
							this.completedWordItemSetActive(tagIdNext, tagIdPrev);
						}
					}
				}
				
				charactersEnteredKeyDownEvent(event)
				{
					if (event.which === this.getArrowDownKey())
					{
						this.completedWordItemSetActive("#completedWordItem-0");
					}
				}
				
				charactersEnteredChangeEvent(event)
				{
					this.processCharactersEntered();
				}
				
				charactersEnteredKeyUpEvent()
				{
					this.processCharactersEntered();
				}
				
				processCharactersEntered()
				{
					this.setAutoCompleteNeeded(true);
					const isNetworkRequestAvailable = techInterviewAjax.networkRequest();
					if (isNetworkRequestAvailable)
					{
						this.setUiNetworkRequestAvailable();
					}
				}
				
				setAutoCompleteNeeded(isNeeded)
				{
					this.isAutoCompleteNeeded = isNeeded;
				}
				
				setUiNetworkRequestAvailable()
				{
					if (this.isAutoCompleteNeeded)
					{
						this.autoComplete();
						this.setAutoCompleteNeeded(false);
					}
				}
				
				autoComplete()
				{
					const charactersEntered = this.getCharactersEntered();
					techInterviewAjax.getSuggestedResultsFromAPI(charactersEntered);
				}
				
				fillAutoCompleteList(autoCompleteList)
				{
					$("#completedWord").empty();
					
					if (autoCompleteList.length < 2)
					{
						autoCompleteList.push("");
						$("#completedWord").hide();
						
					}
					if (autoCompleteList.length > 1)
					{
						
						for (let i=0; i<autoCompleteList.length; i++)
						{
							const tagID = "completedWordItem-" + i;
													
							$("#completedWord").append(
								'<button id="' + tagID + '">' +
								'</button>');
							$("#" + tagID).attr("type", "button");
							$("#" + tagID).addClass("m-0 p-0");
							$("#" + tagID).addClass("list-group-item list-group-item-action");
												
							$("#" + tagID).val(autoCompleteList[i]);
							$("#" + tagID).html(autoCompleteList[i]);

							$("#" + tagID).click(autoCompleteList[i], this.completedWordItemClicked);
							$("#" + tagID).keydown(i, (event) => {this.completedWordKeyDownEvent(event);});
												}
						$("#completedWord").show();
					}
				}
				
				getCharactersEntered()
				{
					return $("#charactersEntered").val();
				}
			}
			
			const techInterviewDebug = new TechInterviewDebug();
			const techInterviewProcessing = new TechInterviewProcessing();
			const techInterviewAjax = new TechInterviewAjax();
			const techInterviewUI = new TechInterviewUI();
			$(document).ready(() => techInterviewUI.initUI());
			
		</script>
	</body>
</html>
<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

		<script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
		<script src="https://unpkg.com/popper.js@1.15.0/dist/umd/popper.min.js" integrity="" crossorigin="anonymous"></script>

		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
		<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

		<link href="flyer-layer.css" rel="stylesheet" type="text/css">
		<link href="assets.css" rel="stylesheet" type="text/css">
		<style type="text/css">
			.v-spacer {
			  height: 100px;
			}
			.h-spacer {
				align-self: center;
			}
			.ui-autocomplete-loading {
				background: white url("loading.gif") right center no-repeat;
			}
			.z-layer-front
			{
				z-index: 5000;
			}
			.z-layer-back
			{
				z-index: 4500;
			}
		</style>
		<title>Technical Interview</title>
	</head>
	<body class="m-0 p-0 gr-sw-font-antic-slab">
		<div class="m-0 p-0 container-fluid">
			<div class="m-0 p-0">
				<div class="m-0 p-0 gr-sw-layer-flyer-min-width">
					<div class="m-0 p-0 h-75">
						<header class="m-0 p-0 gr-sw-layer-flyer-header-thinline">
							<h1 class="m-0 p-0 gr-sw-layer-flyer-header-thinline">
								Technical Interview
							</h1>
						</header>
						<main class="m-0 p-0">
							<article class="m-0 p-0">
								<div class="m-0 p-0 vw-100">
									<div class="m-0 p-0 v-spacer">
									</div>
									<div class="m-0 p-0 w-25 d-inline-block">
									</div>
									<div class="m-0 p-0 w-50 d-inline-block h-spacer">
										<div class="">
											<div id="textEntry" class="m-0 p-0" class="input-group mb-3">
												<input id="charactersEntered" type="text"
													class="form-control" placeholder="Enter characters"
													aria-label="Enter characters" aria-describedby="Submit">
											</div>
										</div>
										<div id="completedWord" class="m-0 p-0 list-group">
										</div>
									</div>
								</div>
							</article>
						</main>
					</div>
				</div>
			</div>
		</div>
		<div id="debug">
		
		</div>
		<script type="text/javascript">
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
			// debug
			
			debug = document.getElementById("debug");
			const isDebugging = false;
			
			function debugOut(text)
			{
				if (isDebugging)
				{
					debug.innerHTML = text + "<br />" + debug.innerHTML;
				}
			}
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			// Processing
			
			function processResults(data, textStatus, jqXHR) {
				textStatus = null;
				jqXHR = null;
				
				const autoCompleteList = unpackJQueryJson(data);
				
				if (validateResults(autoCompleteList))
				{
					sendToUI(autoCompleteList);
				}
			}
			
			function unpackJQueryJson(data)
			{
				return Object.values(data)[0];
			}
		
			function sendToUI(autoCompleteList) {
				fillAutoCompleteList(autoCompleteList);
			}
			
			function validateResults(autoCompleteList)
			{
				communicationsReliabilityThreshold = 0.60;
				let communicationReliabilityThresholdSuccessDensity = 0;
				let communicationReliabilityThresholdSuccessCumulativeDensity = 0;
				let communicationsReliabilityProbablity = 1.00;
				let isValid = true;
				
				charactersEntered = getCharactersEntered();
				for (let i=0; i<autoCompleteList.length; i++)
				{
					if (charactersEntered.length < 3)
					{
						if (autoCompleteList[i].toLocaleLowerCase('en-US').startsWith(
							charactersEntered.toLocaleLowerCase('en-US')))
						{
							communicationReliabilityThresholdSuccessDensity = 1.00;
						}
						else
						{
							communicationReliabilityThresholdSuccessCumulativeDensity = 0.00;
						}
					}
					else
					{
						let communicationItemReliabilitySuccessCount = 0;
						for (let j=0; ( (j<charactersEntered.length) &&
							(charactersEntered.length <= autoCompleteList[i].length) ); j++)
						{
							if (charactersEntered[j].toLocaleLowerCase('en-US') ==
								autoCompleteList[i][j].toLocaleLowerCase('en-US'))
							{
								communicationItemReliabilitySuccessCount++;
							}
						}
						communicationReliabilityThresholdSuccessDensity =
							( communicationItemReliabilitySuccessCount / charactersEntered.length );
					}
					communicationReliabilityThresholdSuccessCumulativeDensity += communicationReliabilityThresholdSuccessDensity;
				}
				communicationsReliabilityProbablity = communicationReliabilityThresholdSuccessCumulativeDensity / autoCompleteList.length;
				if (communicationsReliabilityProbablity < communicationsReliabilityThreshold)
				{
					isValid = false;					
				}
				return isValid;
			}
			
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
			// Ajax
			
			const isNetworkingCapabilityAvailable = true;
			
			let isStressReduced = true;
			let isReducingStress = false;
			
			function networkRequest()
			{
				let isNetworkRequestAvailable = false;
				if (isStressReduced)
				{
					isNetworkRequestAvailable = true;
					setNetworkRequestPermitted();
				}
				return isNetworkRequestAvailable;
			}
			
			function setNetworkRequestPermitted()
			{
				isStressReduced = false;
				setNetworkToReduceStress();
			}
			
			function setNetworkToReduceStress()
			{
				isReducingStress = true;
				setTimeout(setNetworkDeStressed, 1000);			
			}
			
			function setNetworkDeStressed()
			{
				isStressReduced = true;
				isReducingStress = false;
				setUiNetworkRequestAvailable();
			}

			function getSuggestedResultsFromAPI(charactersToAutocomplete)
			{
				if (isNetworkingCapabilityAvailable) {
					const apiRequest = genereateApiRequest(charactersToAutocomplete);
					$.get( apiRequest, null, processResults, "json" );
				}
				else {
					processResults(getLocalDataSet(), null, null);
				}
			}
			
			function genereateApiRequest(charactersToAutocomplete)
			{
				return "https://mock-autocomplete.herokuapp.com/autocomplete?q="
					+ charactersToAutocomplete;
			}
			
			function getLocalDataSet()
			{	
				data = {"data":["Alabama","Alaska","Ã…land Islands"]};
				//data = {"data":["Afghanistan","Alabama","Alaska","Albania","Albany"]};
				return data;
			}
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			// UI
			
			$(document).ready(initUI);
			let isAutoCompleteNeeded = false;
			const arrowDownKey = 40;
			const arrowUpKey = 38;
			
			function initUI()
			{
				initUIEvents();
			}
			
			function ititUIElements()
			{
				$("#completedWord").hide();
			}
			
			function initUIEvents()
			{
				$("#charactersEntered").keydown(charactersEnteredKeyDownEvent);
				$("#charactersEntered").keyup(charactersEnteredKeyUpEvent);
				$("#completedWord").focusout(completedWordFocusOut);
			}
			
			function completedWordFocusOut(event)
			{
				completedWordItemsReset();
			}
			
			function completedWordItemClicked(event)
			{
				const selectedItem = event.data;
				$("#charactersEntered").val(selectedItem);
				$("#completedWord").hide();
			}
			
			function completedWordChangeEvent()
			{
				$("#charactersEntered").val($("#completedWord").val());
			}
			
			function completedWordItemsReset()
			{
				$("#completedWord > button").removeClass("active");
			}
			
			function completedWordItemSetActive(tagIdNext, tagIdPrev)
			{
				$(tagIdNext).trigger("focus");
				$(tagIdNext).addClass("active");
				
				$(tagIdPrev).removeClass("active");
			}
			
			function completedWordKeyDownEvent(event)
			{
				if ((event.which === arrowDownKey) || 
					(event.which === arrowUpKey))
				{
					let modifier = null;
					let isRoomLeft = true;
					const tagButtons = "#completedWord > button";
					if (event.which === arrowDownKey)
					{
						modifier = 1;
						isRoomLeft = (event.data < $(tagButtons).length - 1);
					}
					else if (event.which === arrowUpKey)
					{
						modifier = -1;
						isRoomLeft = (event.data > 0);
						if (!isRoomLeft)
						{
							$("#charactersEntered").trigger("focus");
						}
					}

					const tagIdPrev = "#completedWordItem-" + event.data;
					const tagIdNext = "#completedWordItem-" + (event.data + modifier);
					if (isRoomLeft)
					{
						completedWordItemSetActive(tagIdNext, tagIdPrev);
					}
				}
			}
			
			function charactersEnteredKeyDownEvent(event)
			{
				if (event.which === arrowDownKey)
				{
					completedWordItemSetActive("#completedWordItem-0");
				}
			}
			
			function charactersEnteredChangeEvent(event)
			{
				processCharactersEntered();
			}
			
			function charactersEnteredKeyUpEvent()
			{
				processCharactersEntered();
			}
			
			function processCharactersEntered()
			{
				setAutoCompleteNeeded(true);
				isNetworkRequestAvailable = networkRequest();
				if (isNetworkRequestAvailable)
				{
					setUiNetworkRequestAvailable();
				}
			}
			
			function setAutoCompleteNeeded(isNeeded)
			{
				isAutoCompleteNeeded = isNeeded;
			}
			
			function setUiNetworkRequestAvailable()
			{
				if (isAutoCompleteNeeded)
				{
					autoComplete();
					setAutoCompleteNeeded(false);
				}
			}
			
			function autoComplete()
			{
				charactersEntered = getCharactersEntered();
				getSuggestedResultsFromAPI(charactersEntered);
			}
			
			function fillAutoCompleteList(autoCompleteList)
			{
				$("#completedWord").empty();
				
				if (autoCompleteList.length < 2)
				{
					autoCompleteList.push("");
					$("#completedWord").hide();
					
				}
				if (autoCompleteList.length > 1)
				{
					
					for (let i=0; i<autoCompleteList.length; i++)
					{
						const tagID = "completedWordItem-" + i;
												
						$("#completedWord").append(
							'<button id="' + tagID + '">' +
							'</button>');
						$("#" + tagID).attr("type", "button");
						$("#" + tagID).addClass("m-0 p-0");
						$("#" + tagID).addClass("list-group-item list-group-item-action");
											
						$("#" + tagID).val(autoCompleteList[i]);
						$("#" + tagID).html(autoCompleteList[i]);

						$("#" + tagID).click(autoCompleteList[i], completedWordItemClicked);
						$("#" + tagID).keydown(i, completedWordKeyDownEvent);
											}
					$("#completedWord").show();
				}
			}
			
			function getCharactersEntered()
			{
				return $("#charactersEntered").val();
			}
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
		</script>
	</body>
</html>